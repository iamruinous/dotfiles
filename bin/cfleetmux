#!/bin/bash

FLEETCTL_TUNNEL=`aws --profile crossyio ec2 describe-instances --filters "Name=tag:Name,Values=service-cluster" | jq -r '.Reservations[].Instances[].PublicIpAddress' | grep -v null | head -n 1`

SESSION='cfleetmux'

tmux start-server
tmux new-session -d -s $SESSION -n √ø
tmux send-keys -t $SESSION:0.0 "tmux kill-session -t $SESSION"

tmux set-environment -t $SESSION FLEETCTL_TUNNEL $FLEETCTL_TUNNEL
tmux set-environment -t $SESSION ETCDCTL_PEERS http://${FLEETCTL_TUNNEL}:2379

tmux new-window -t $SESSION:1 -n fleetctl
tmux send-keys -t $SESSION:1.0 "fleetctl list-machines" C-m

tmux select-window -t $SESSION:1
tmux attach-session -t $SESSION
